2003-02-05  Martin Baulig  <martin@ximian.com>

	Modified the symbol file format to speed up method looks by name
	and cleaned this up a lot.

	* MonoSymbolFile.cs: New public class.  This is now a public class
	and writes and reads the symbol file.

	* IMonoBinaryReader.cs: Removed.

	* MonoSymbolTable.cs: Set version number to 29.

2003-01-17  Zoltan Varga  <vargaz@freemail.hu>

	* MonoSymbolWriter.cs (OpenMethod): Make it work on constructors.

2002-10-13  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 28.
	(SourceFileEntry): Read the methods when they're needed.
	(MethodSourceEntry): Made this a struct, not a class.

2002-10-13  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 27.  Added a source
	file table which is used to search a method by source file + line number.

2002-09-21  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 26.  Removed all the dynamic
	stuff, this library now just deals with the compiler generated symbol table.
	The dynamic stuff is private between the JIT and the debugger.

2002-09-21  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 25.  Added information about
	local variables.

2002-09-20  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 24.  Added a type index
	table.  Write the type of a local variable or a parameter as an index
	into this table.

2002-09-20  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs: Remove all the unused interfaces.

2002-09-20  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 23, include the size
	of a variable.

2002-09-20  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 22.  Provide information
	about parameters and local variables.

2002-09-20  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs: Use fullly qualified name for
	System.Diagnostics.SymbolStore.ISymbolWriter rather than `using' this
	namespace.  This allows us to use the name `ISymbolWriter' in our own
	code.

2002-09-18  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 21.  Encode the source file
	as a 4-byte length field followed by the UTF8 encoded string.

2002-09-18  Martin Baulig  <martin@gnome.org>

	* IMonoBinaryReader.cs: New interface.

	* MonoSymbolTable.cs: Use IMonoBinaryReader instead of binary reader.

2002-09-16  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Set version number to 20.

2002-09-14  Martin Baulig  <martin@gnome.org>

	* MonoSymbolWriter.cs, IMonoSymbolWriter.cs, MonoSymbolTableWriter.cs:
	Make all classes and interfaces which don't need to be public internal.

2002-09-14  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Use only CLS-compliant types here, bumped version
	number to 19.

	* MonoSymbolTableReader.cs: Removed, this is now in the debugger.

2002-09-03  Martin Baulig  <martin@gnome.org>

	* AssemblerWriterI386.cs, IAssemblerWriter.cs, MonoDwarfFileWriter.cs,
	README, README.relocation-table, csharp-lang.[ch], gdb-csharp-support.patch,
	gdb-variable-scopes.patch: Removed.

2002-09-03  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTableReader.cs (MonoSymbolTableReader.ImageFile): New
	public property.

	* MonoSymbolTable.cs: Bumped version number to 18.

2002-08-27  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs (MethodAddress): Removed `TrampolineAddress'.

2002-08-27  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs: Changed the file format in a way that allows us
	open it read-only and to use a specially malloced area for all the
	dynamic data.	

2002-08-25  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTableReader.cs: New file.  This is the reader for the
	new symbol file format.

2002-08-24  Martin Baulig  <martin@gnome.org>

	* MonoSymbolTable.cs, MonoSymbolTableWriter.cs: New files.  This
	creates a binary application.dbg file which will be used by the
	JIT to display source lines for exceptions.

	* list.unix: Disabled the dwarf file writer in the build.

2002-08-23  Martin Baulig  <martin@gnome.org>

	* MonoSymbolWriter.cs (MonoSymbolWriter.Initialize): Added
	assembly name argument.  Since the symbol writer needs to read the
	final assembly, we need to give it its full pathname.

2002-08-23  Martin Baulig  <martin@gnome.org>

	* makefile.gnu, list.unix: Added.

2002-07-05  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Added support for types in referenced assemblies.

2002-07-05  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Added support for arrays.

	* gdb-csharp-support.patch: Updated.

2002-06-29  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs (DieInheritance): Make this actually work.

2002-06-29  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs, MonoSymbolWriter.cs: Put all TAG_subprogram's into their
	corresponding struct/class declarations.

2002-06-28  Martin Baulig  <martin@gnome.org>

	* gdb-csharp-support.patch: Updated.

2002-06-28  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Use a TAG_string_type when we're using GNU extensions.
	Make static struct/class fields actually work.  Provide a TAG_typedef for struct's
	and classes.

2002-05-30  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter (IMonoSymbolWriter): Added custom `Initialize' method.

	* MonoSymbolWriter.cs (Initialize): The ISymbolWriter's `Initialize' method
	is no longer supported and throws an exception.
	(Initialize (string, string[])): New custom initialization function.

	* MonoDwarfFileWriter.cs (DwarfFileWriter): Added `string[] args' argument
	to the constructor to pass command line arguments.

	* gdb-csharp-support.patch: Updated for GDB 5.2.

2002-05-30  Martin Baulig  <martin@gnome.org>

	* MonoSymbolWriter.cs (MonoSymbolWriter): The constructor now get's the
	AssemblyBuilder's `methods' array as third argument.
	(OpenMethod): Use this array to get the method builder rather than using an
	interncall for it.
	(get_method_builder): Removed this interncall.

2002-05-25  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Finished the type rewrite, put back strings and arrays.

2002-05-24  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (ISourceMethod): Added `FullName' and `Parameters'.
	(ITypeHandle): New interface.

	* DwarfFileWriter.cs: Largely reorganized the type writing code.  Types are
	now represented by ITypeHandle objects which are stored in a per-dwarf-writer
	hash table.  At the moment, all types still need to be in one compile unit due
	to lacking support in gdb - but this new type code here already supports this.

	* MonoSymbolWriter.cs: Moved all the subclasses to the top-level and made them
	public, cleaned up the code, put everything into one compile unit.
	(DefineLocalVariable): Added a version of this function which takes useful args.

2002-05-22  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (IMonoSymbolWriter): Added `Sources' and `Methods'
	properties.

	* MonoDwarfFileWriter.cs (WriteSymbolTable): New public method.  Moved the
	code that writes the "mono_line_numbers" section here from the LineNumberEngine.

2002-05-22  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (IVariable): Replaced Token with `ISourceMethod Method'.

	* MonoSymbolWriter.cs (MonoSymbolWriter): The constructor now has an additional
	ModuleBuilder argument.
	(OpenMethod): Immediately call the `get_method' interncall to get the MethodBase
	from the token, then store the MethodBase instead of the token.  The token may
	still change during the metadata library's fixup process.
	(DoFixups): When the image has been written to disk, call the GetToken () method
	on all MethodBuilders and all ConstructorBuilders to get the final metadata tokens.

2002-05-22  Martin Baulig  <martin@gnome.org>

	* AssemblerWriterI386.cs: Don't use GNU extensions and produce assembler
	output which is free of comments and extra whitespaces so that it's suitable
	for `as -f'.

2002-05-22  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (ISourceMethod): Replaced `MethodInfo MethodInfo' with
	`MethodBase MethodBase' and added `Type ReturnType'.  We're now correctly
	dealing with constructors and not crashing anymore.

2002-05-21  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Write a special line number table which can be read
	in by the metadata library to get line number information in backtraces.

2002-05-06  Martin Baulig  <martin@gnome.org>

	* MonoSymbolWriter.cs (MonoSymbolWriter.Close): Use Assembly.LoadFrom (), not
	AppDomain.Load () to load the assembly.

2002-04-26  Martin Baulig  <martin@gnome.org>

	* gdb-csharp-support.patch: A patch for GDB (against the latest CVS version)
	to implement C# support.

	* csharp-lang.c, csharp-lang.h, csharp-mono-lang.c: Copy these into your GDB
	source directory after applying the patch.

2002-04-26  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs (DieInternalString): Removed.

2002-04-25  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Reflect latest MonoString changes.

2002-04-13  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (ISourceBlock): Added `Blocks' property and `AddBlock'
	method to support nested blocks.

	* MonoSymbolWriter.cs: Correctly handle nested blocks.

	* MonoDwarfFileWriter.cs (DieMember): Provide info for all fields, not just for
	public ones; also added DW_AT_accessibility.
	(DieVariable): Reflected latest debug-symfile.c changes.

2002-04-12  Martin Baulig  <martin@gnome.org>

	* gdb-variable-scopes.patch: A patch for GDB (against the latest CVS version)
	to implement variable lifetimes.

2002-04-12  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs (DieVariable): Provide info about the variable's
	lifetime using DW_AT_begin_scope and a new baulig extension DW_AT_end_scope.

2002-03-29  Martin Baulig  <martin@gnome.org>

	* AssemblerWriterI386.cs: Rewrote most of the string output function, do the
	number->string conversion manually. It's now taking about 15 seconds to write
	a symbol file for MCS, no longer more than a minute.

	* MonoDwarfFileWriter.cs: Added some profiling code, speeded things up, fixed
	a few bugs.

2002-03-25  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs (CreateType): Return a `DieType'.
	(RegisterType): Add the type to the type hash before creating dependency types
	so we don't get recursion loops.
	(RegisterPointerType): New func to register a "pointer to type" type.
	(DieTypeDef, DiePointerType, DieArrayType, DieStringType, DieClassType): New
	types; added support for strings, arrays and basic support for classes.
	
2002-03-24  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs: Killed all methods in this interface, no longer needed.

	* MonoSymbolWriter.cs (MonoSymbolWriter): The constructor now takes a string
	argument which is the full pathname of the assembly - you must call Close()
	after the assembly has been written to disk since the symbol writer needs to
	load the finished assembly to get its metadata.

	* MonoDwarfFileWriter.cs: Added support for enums and structs.
	
2002-03-24  Martin Baulig  <martin@gnome.org>

	* MonoDwarfFileWriter.cs: Added support for method parameters.

2002-03-24  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (IMonoSymbolWriter): Removed my custom OpenMethod(),
	we're now using the ISymbolWriter's method.
	(IVariable): Added `byte[] Signature' property.

	* MonoSymbolWriter.cs (SetAssembly): New method. This must be called before
	Close(); the assembly parameter is the already-written assembly, ie. it must
	contain the full metadata.
	(OpenMethod): Only take the token argument and set MethodInfo later in DoFixups.
	(SetMethodSourceRange): You must call this function to tell the symbol writer
	in which source file the method is defined.
	(DefineLocal): Store the signature in the local.
	(DoFixups): Use two new interncalls to set the SourceMethod's MethodInfo field
	and the LocalVariable's Type field.

2002-03-23  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (ISourceBlock): New interface.
	(ILocalVariable): Renamed this interface to IVariable.
	(IVariable): Added Line, Type, Token.
	(ILocalVariable, IMethodParameter): New interfaces, derive from IVariable.
	(ISourceMethod): Added Blocks. Renamed FirstLine and LastLine to Start and End,
	changed their type to ISourceLine. Removed CodeSize.
	(ISourceLine): Renamed Line to Row, added Column. Added OffsetType and Offset.

	* MonoDwarfFileWriter.cs (MonoDwarfFileWriter.DieLexicalBlock): New class.
	(MonoDwarfFileWriter.DieMethodVariable): New class.

	* MonoSymbolWriter.cs (OpenScope, CloseScope): Implemented.
	Reflected latest IMonoSymbolWriter interface changes.

2002-03-20  Martin Baulig  <martin@gnome.org>

	* IAssemblerWriter.cs: New interface.

	* AssemblerWriterI386.cs: New class.

	* MonoDwarfFileWriter.cs: Use the IAssemblerWriter interface to make this class
	platform and assembler independent.

2002-03-20  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (ISourceMethod): Added FirstLine, LastLine, CodeSize and
	Token properties.

	* MonoDwarfFileWriter.cs: Implemented line number support.

2002-03-19  Martin Baulig  <martin@gnome.org>

	* IMonoSymbolWriter.cs (ISourceFile, ISourceMethod, ISourceLine, ILocalVariable):
	New interfaces.

	* IMonoSymbolWriter.cs (OpenMethod): Take a System.Reflection.MethodInfo, not
	a string.

2002-03-19  Martin Baulig  <martin@gnome.org>

	This is an implementation of the System.Diagnostics.SymbolStore.SymbolWriter
	interface. It's still work in progress and not yet used anywhere.

	There is some preliminary documentation in the source files and some more
	docu in the README and README.relocation-table files.

	* IMonoSymbolWriter.cs: New file.
	* MonoDwarfFileWriter.cs: New file.
	* MonoSymbolDocumentWriter.cs: New file.
	* MonoSymbolWriter.cs: New file.

	* README, README.relocation-table: Documentation.

