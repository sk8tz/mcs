#!/bin/sh

mono=${MCSTOOL_MONO:-mono}
compiler=${MCSTOOL_MCSEXE:-/usr/bin/mcs.exe}

test $mono != mono && echo "$0: using special interpreter $mono"

command="$mono $compiler"

while test $# -gt 0 ; do
    case $1 in
    -o)
	shift
	outfile="$1"
	command="$command -o $1"
	;;
    /o:*)
	outfile="`echo $1 |sed -e 's,/o:,,'`"
	command="$command $1"
	;;
    *)
	command="$command $1"
	;;
    esac
    shift
done

echo $command
eval $command

test $? -ne 0 && exit 1

if echo $outfile |grep '\.exe$' >/dev/null ; then
    wrapper=`echo $outfile |sed -e 's,\.exe$,,'`
    echo "$0: creating wrapper $wrapper"
    cat >"$wrapper" <<EOF
#!/bin/sh

d=\`dirname \$0\`
$mono "\$d/`basename $outfile`" \$*
exit \$?
EOF
    chmod 755 "$wrapper"
fi

exit 0
