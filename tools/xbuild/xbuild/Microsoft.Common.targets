<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<PropertyGroup>
		<TargetExt Condition="'$(OutputType)' == 'Winexe'">.exe</TargetExt>
		<TargetExt Condition="'$(OutputType)' == 'Exe'">.exe</TargetExt>
		<TargetExt Condition="'$(OutputType)' == 'Library'">.dll</TargetExt>
		<TargetExt Condition="'$(OutputType)' == 'Netmodule'">.netmodule</TargetExt>
	</PropertyGroup>

	<PropertyGroup>
		<ProjectDir Condition="'$(ProjectDir)' == ''">$(MSBuildProjectDirectory)\</ProjectDir>
	</PropertyGroup>

	<PropertyGroup>
		<AllowUnsafeBlocks Condition="'$(AllowUnsafeBlocks)' == ''">false</AllowUnsafeBlocks>
		<AssemblyName Condition="'$(AssemblyName)' == ''">$(RootNamespace)</AssemblyName>
		<!--<OutputPath Condition="'$(OutputPath)' != ''">$(OutputPath)\</OutputPath>-->
		<WarningLevel Condition="'$(WarningLevel)' == ''" >2</WarningLevel>
	</PropertyGroup>

	<Target Name="PrepareForBuild">
		<Message Importance="High" Text="Configuration: $(Configuration) Platform: $(Platform)"/>
		
		<MakeDir 
			Condition="'$(OutputPath)' != ''"
			Directories="$(OutputPath)"
		/>
	</Target>

	<Target Name="ResolveAssemblyReferences">
		<ResolveAssemblyReference
			Assemblies="@(Reference)"
			SearchPaths=" "
		>
			<Output TaskParameter="ResolvedFiles" ItemName="ResolvedFiles"/>
		</ResolveAssemblyReference>
	</Target>

	<Target
		Name="ResolveProjectReferences"
		Condition=" '@(ProjectReference)' != ''"
		Inputs="@(ProjectReference)"
		Outputs="@(ChildProjectReferences)"
	>
		<MSBuild
			Projects="@(ProjectReference)"
			Targets="Build"
			RebaseOutputs="true"
		>
			<Output TaskParameter="TargetOutputs" ItemName="ChildProjectReferences" />
		</MSBuild>
	</Target>

<!--
	Not needed at the moment
	<Target Name="_ComputeNonExistentFileProperty" Condition='false'>
		<CreateProperty Value="__NonExistentSubDir__\__NonExistentFile__">
			<Output TaskParameter="Value" PropertyName="NonExistentFile"/>
		</CreateProperty>
	</Target>
-->

	<Target
		Name="Build"
		DependsOnTargets="PrepareForBuild;ResolveAssemblyReferences;ResolveProjectReferences;CoreCompile"
		Outputs="$(OutputPath)$(AssemblyName)$(TargetExt)"
	/>

<!--
	Doesn't work because it treats every property in Delete.Files as separate ITaskItem
	<Target Name="Clean">
		<Message Text="Trying to delete $(OutputPath)$(AssemblyName)$(TargetExt)"/>
		<Delete Files="$(OutputPath)$(AssemblyName)$(TargetExt)" />
	</Target>
-->

</Project>
